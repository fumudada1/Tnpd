
@using MvcPaging
@using Tnpd.Helpers
@model MvcPaging.IPagedList<TnpdModels.CasePoproc>

@{
    ViewBag.Title = "承辦人作業";
}

<h2>承辦人作業</h2>
  

<table class="table table-v">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.FirstOrDefault().Case.CaseID)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.FirstOrDefault().CaseType)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.FirstOrDefault().Case.InitDate)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.FirstOrDefault().Case.Name)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.FirstOrDefault().Case.Subject)
        </th>
        
        <th>
            @Html.DisplayNameFor(model => model.FirstOrDefault().Case.Predate)
        </th>
        <th>
            辦理天數
        </th>
        <th>
           案件狀態
        </th>
        
    </tr>
<tbody>
@foreach (var item in Model) {
    <tr>
        <td>
           
            @Html.ActionLink(item.Case.CaseID.ToString(), "ProcessEdit", new { id=item.Id,pclass=Request["pclass"]}) 
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Case.CaseType)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Case.InitDate)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Case.Name)
        </td>

        <td>
            @Html.DisplayFor(modelItem => item.Case.Subject)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Case.Predate)
        </td>
        <td>
            @{
                Double timespan;
                if (item.EndDateTime.HasValue)
                {

                    timespan = new TimeSpan(item.EndDateTime.Value.Ticks -
                                            item.InitDate.Value.Ticks).TotalDays;
                    @Math.Round(timespan, 2).ToString()
                }
                else
                {

                    timespan = new TimeSpan(DateTime.Now.Ticks - item.Case.InitDate.Value.Ticks).TotalDays;
                    @Math.Round(timespan, 2).ToString()
                }

            }
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Status)
            @if (item.Case.Cases.Count > 0)
            {
                <br/>  <span><img src="/Images/documents.png" style="width: 20px"/>併案案件</span> 
            }   
        </td>
      
    </tr>
}
</tbody>
</table>

<div class="pager">
    @Html.Pager(Model.PageSize, Model.PageNumber, Model.TotalItemCount).Options(x => x.AddRouteValue("pclass", Request["pclass"]))
</div>
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    @Scripts.Render("~/bundles/jqueryui")
    @Styles.Render("~/Content/themes/base/css")
    <script>
        $(document).ready(function() {
            $(".datepicker").datepicker();

        });
    </script>
}

