@using TnpdModels
@model TnpdModels.CasePoproc

@{
    ViewBag.Title = "承辦人作業";
    string subject = "";
    string path = @"C:\website\tnpd\tnpd\TrafficFiles\";
   
}

<h2>承辦人作業</h2>

@using (Html.BeginForm(null, null, FormMethod.Post, new { enctype = "multipart/form-data" }))
{

    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)

    <fieldset>
        <legend>Case</legend>
        @Html.HiddenFor(model => model.Id)
        <input type="hidden" name="pclass" value="@ViewBag.pclass" />
        合併案件共 @Model.Case.Cases.Count() 件<br/> <br/>
        <span style="color: black">辦理情形</span>
        <table class="table table-v">

            <tbody>
                <tr>
                    <td style="width: 50%">案號：@Model.Case.CaseID
                    </td>
                    <td></td>
                </tr>
                <tr>
                    <td>案件來源：@Model.Case.CaseType
                    </td>
                    <td>案件日期：@Model.Case.InitDate
                    </td>
                </tr>
                <tr>
                    <td>承辦單位： 
                        @if (@Model.assignUnit.ParentUnit != null)
                              {
                                  <td>承辦單位：@Model.assignUnit.ParentUnit.Subject - @Model.assignUnit.Subject
                                  </td>
                              }
                              else
                              {
                                  <td>承辦單位：@Model.assignUnit.Subject
                                  </td>
                              }
                    </td>
                    <td>承辦人：@Model.assignMember.Name
                    </td>
                </tr>
                <tr>
                    <td>預結案日：@Model.Case.Predate
                    </td>
                    <td>案件狀態：@Model.Status
                    </td>
                </tr>
            </tbody>
        </table>
        <span style="color: black">處理紀錄</span>
        <table class="table table-v">
            <thead>
              <tr>
                    <th>日期</th>
                    <th>承辦單位</th>
                    <th>承辦人</th>
                    <th>作業</th>
                </tr>
            </thead>
            <tbody>
            @foreach (CasePoprocLog log in Model.Case.PoprocslLogs.OrderByDescending(x => x.InitDate))
            {
             <tr>
                 <td>
                     @log.InitDate
                 </td>
                 @if (log.assignUnit != null)
                 {
                     <td>
                         @log.assignUnit.ParentUnit.Subject - @log.assignUnit.Subject
                     </td>
                 }
                 else
                 {
                     <td>
                         
                     </td>
                 }
                 <td>
                     @log.assignMember.Name</td>
                 <td>
                     @log.Action
                 </td>

            </tr>
            }
            

            </tbody>
        </table>
        <span style="color: black">案件資料</span>

        @if (Model.CaseType == CaseType.分局長與大隊隊長信箱 || Model.CaseType == CaseType.首長信箱)
        {
    
   
            <table class="table table-v">

                <tbody>
                    <tr>
                        <td>姓名：@Model.Case.Name</td>
                        <td>性別：@Model.Case.Gender</td>

                    </tr>
                    <tr>

                        <td>電話：@Model.Case.TEL</td>
                        <td>職業：@Model.Case.Job</td>
                    </tr>
                    <tr>

                        <td colspan="2">E-mail：@Model.Case.Email</td>

                    </tr>
                    <tr>

                        <td colspan="2">地址：@Model.Case.Address</td>

                    </tr>
                    <tr>

                        <td colspan="2">主題：@Model.Case.Subject</td>
                        @{
            subject = Model.Case.Subject;
                        }
                    </tr>
                    <tr>

                        <td colspan="2">內容：<br />
                             @Html.Raw(UIUtility.Txt2Html(Model.Case.Content))
                        </td>

                    </tr>
                    <tr>

             <td colspan="2">上傳附件檔：<br />
                @if (!string.IsNullOrEmpty(Model.Case.Upfile1))
                {

                    FileInfo finfo = new FileInfo(path + Model.Case.Upfile1);
                    if (finfo.Exists)
                    {
                         <a href="/TrafficFiles/@Model.Case.Upfile1" target="_black">@Model.Case.Upfile1</a>
                    }
                    else
                    {
                     <a href="http://10.128.0.43:8080/@Model.Case.Upfile1" target="_black">@Model.Case.Upfile1</a>
                    }
                   
                }
                @if (!string.IsNullOrEmpty(Model.Case.Upfile2))
                {
                    FileInfo finfo = new FileInfo(path + Model.Case.Upfile2);
                    if (finfo.Exists) { 
                         <br/>  <a href="/TrafficFiles/@Model.Case.Upfile2" target="_black">@Model.Case.Upfile2</a>
                    }else{
                        
                   <br/>    <a href="http://10.128.0.43:8080/@Model.Case.Upfile2" target="_black">@Model.Case.Upfile2</a>
                    }
                   
                }
                @if (!string.IsNullOrEmpty(Model.Case.Upfile3))
                {
                    FileInfo finfo = new FileInfo(path + Model.Case.Upfile3);
                    if (finfo.Exists) { 
                         <br/>  <a href="/TrafficFiles/@Model.Case.Upfile3" target="_black">@Model.Case.Upfile3</a>
                    }else{
                        
                   <br/>    <a href="http://10.128.0.43:8080/@Model.Case.Upfile3" target="_black">@Model.Case.Upfile3</a>
                    }
                }
                
            </td>

        </tr>


                </tbody>
            </table>
        }
        else if (Model.CaseType == CaseType.參觀本局暨所屬機關)
        {
            <table class="table table-v">

                <tbody>

                    <tr>
                        <td>參觀對象：@Model.Case.Unit</td>
                        <td>申請單位名稱：@Model.Case.OrgName</td>


                    </tr>
                    <tr>
                        <td>聯絡人：@Model.Case.Name</td>
                        <td>聯絡人電話：@Model.Case.TEL</td>

                    </tr>
                    <tr>

                        <td colspan="2">E-mail：@Model.Case.Email</td>

                    </tr>
                    <tr>

                        <td colspan="2">預定參觀人數：@Model.Case.pcnt</td>

                    </tr>
                    <tr>

                        <td>預定參觀日期：@Model.Case.ODate </td>
                        <td>預定參觀時間：@Model.Case.STime ~ @Model.Case.ETime</td>
                    </tr>
                    <tr>
                        @{
            subject = "參觀" + Model.Case.Unit + "，預定參觀日期：" + Model.Case.ODate + " " + Model.Case.STime + "~" + Model.Case.ETime;
                        }
                        <td colspan="2">備註：<br />
                             @Html.Raw(UIUtility.Txt2Html(Model.Case.Content))
                        </td>

                    </tr>


                </tbody>
            </table>
        }
        else if (Model.CaseType == CaseType.婦幼安全警示地點)
        {
            <table class="table table-v">

                <tbody>
                <tr>
                    <td>姓名：@Model.Case.Name</td>
                    <td>性別：@Model.Case.Gender</td>

                </tr>
                <tr>

                    <td>電話：@Model.Case.TEL</td>
                    <td>職業：@Model.Case.Job</td>
                </tr>
                <tr>

                    <td colspan="2">E-mail：@Model.Case.Email</td>

                </tr>
                <tr>

                    <td>區別：@Model.Case.OArea</td>
                    <td>路段或地點：@Model.Case.Oplace</td>

                </tr>
                <tr>

                    <td colspan="2">地址：@Model.Case.Address</td>

                </tr>
                <tr>

                    <td colspan="2">通報原因：@Model.Case.Subject</td>
                    @{
            subject = Model.Case.Subject;
                    }
                </tr>
                <tr>

                    <td colspan="2">通報內容：<br />
                         @Html.Raw(UIUtility.Txt2Html(Model.Case.Content))
                    </td>

                </tr>


                </tbody>
            </table>
        }
        else if (Model.CaseType == CaseType.檢舉貪瀆信箱)
        {
            <table class="table table-v">

                <tbody>
                <tr>
                    <td>姓名：@Model.Case.Name</td>
                    <td>性別：@Model.Case.Gender</td>

                </tr>
                <tr>

                    <td>電話：@Model.Case.TEL</td>
                    <td>職業：@Model.Case.Job</td>
                </tr>
                <tr>

                    <td colspan="2">E-mail：@Model.Case.Email</td>

                </tr>
                <tr>

                    <td colspan="2">地址：@Model.Case.Address</td>

                </tr>
                <tr>

                    <td colspan="2">通報原因：@Model.Case.Subject</td>
                    @{
            subject = Model.Case.Subject;
                    }
                </tr>
                <tr>

                    <td colspan="2">通報內容：<br />
                        @Html.Raw(UIUtility.Txt2Html(Model.Case.Content))
                    </td>

                </tr>


                </tbody>
            </table>
        }
        else if (Model.CaseType == CaseType.網路報案)
        {
            <table class="table table-v">

                <tbody>
                <tr>
                    <td>姓名：@Model.Case.Name</td>
                    <td>性別：@Model.Case.Gender</td>

                </tr>
                <tr>

                    <td>聯絡電話(住家)：@Model.Case.HomeTEL</td>
                    <td>聯絡電話(辦公室)：@Model.Case.OfficeTEL</td>
                </tr>
                <tr>

                    <td colspan="2">現居地址：@Model.Case.PostalCode @Model.Case.Address</td>

                </tr>
                <tr>

                    <td colspan="2">戶籍地址：@Model.Case.PPostalCode @Model.Case.PAddress</td>

                </tr>
                <tr>

                    <td colspan="2">行動電話：@Model.Case.TEL</td>

                </tr>
                <tr>

                    <td colspan="2">E-mail：@Model.Case.Email</td>

                </tr>
                <tr>

                    <td colspan="2">報案人類別：@Model.Case.CaseReportType</td>

                </tr>
                <tr>

                    <td>發生日期：@Model.Case.ODate</td>
                    <td>發生時間：@Model.Case.STime </td>
                </tr>
                <tr>

                    <td colspan="2">發生地點：@Model.Case.Oplace</td>

                </tr>
                
                <tr>

                    <td colspan="2">案情摘要：<br />
                        @Html.Raw(UIUtility.Txt2Html(Model.Case.Content))
                    </td>

                </tr>


                </tbody>
            </table>
        }



   
        <div id="divExtension" style="padding: 15px;">
            <table class="table table-v">
                <tr>
                    <td>
                        展延日期
                    </td>
                    <td>
                       @Model.DelyDateTime.Value.ToString("yyyy/MM/dd")
                    </td>
                </tr>
                <tr>
                    <td>
                        展延原因
                    </td>
                    <td>
                        @Html.Raw(UIUtility.Txt2Html(Model.DelyMemo))
                      
                    </td>
                </tr>
                <tr>
                  
                    <td colspan="2">
                        <input type="radio"  name="isPass" id="noPass" value="0" />
                        <label for="noPass">不允許</label>
                        <input type="radio"  name="isPass" id="Pass" value="1" checked="checked" />
                        <label for="noPass">允許</label>
                    </td>
                    
                </tr>
                <tr>
                    <td colspan="2">

                        <input type="submit" id="btnExtension" value="審核"/> 
                    </td>
                </tr>
            </table>
    </div>
    
        <div>
     
       
    </div>
  
    </fieldset>
}
<style>
    label {
        display: inline;
        font-size: 16px;
        font-weight: 600;
    }
</style>
   
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    @Scripts.Render("~/bundles/jqueryui")
    @Styles.Render("~/Content/themes/base/css")
    <script>
        $(document).ready(function() {
            $(".datepicker").datepicker();
            
        });


    </script>


}

@if (ViewBag.message != null)
{
<script>
    alert("@ViewBag.message");
    window.location.href = "/Case/Extension?pclass=@ViewBag.pclass";
</script>
}