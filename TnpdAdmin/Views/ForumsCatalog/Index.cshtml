@using Tnpd.Helpers
@model List<TnpdModels.ForumsCatalog>

@{
    ViewBag.Title = "討論區類別管理";
}

<h2>@ViewBag.Title</h2>

<div class="top">
    @Html.ActionLink("新增", "Create",null,new { @class = "btn btn-primary" })
</div>



@using (Html.BeginForm())
{
<div class="search">
        @Html.DisplayNameFor(model => model.FirstOrDefault().Title)：@Html.InputSearchBox("SearchByTitle", ViewData["SearchByTitle"]) <input type="submit" value="搜尋" class="btn-button">
    </div>
   
}

<table class="table table-v">
    <tr>
        <th width="13%">
            @Html.DisplayNameFor(model => model.FirstOrDefault().Title)
        </th>
        <th width="13%">
            @Html.DisplayNameFor(model => model.FirstOrDefault().Memo)
        </th>
        <th width="13%">
            @Html.DisplayNameFor(model => model.FirstOrDefault().ListNum)
        </th>
         <th width="13%">
            新排序
        </th>
        <th width="13%"  style="display:none">
            @Html.DisplayNameFor(model => model.FirstOrDefault().Poster)
        </th>
        <th width="13%"  style="display:none">
            @Html.DisplayNameFor(model => model.FirstOrDefault().InitDate)
        </th>
        <th width="13%" style="display:none">
            @Html.DisplayNameFor(model => model.FirstOrDefault().UpdateDate)
        </th>
        <th width="13%">功能</th>
    </tr>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Title)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Memo)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.ListNum)
                </td>
                <td>
                    @Html.TextBoxFor(modelItem => item.ListNum, new { @class = "position" })
                </td>
                <td  style="display:none">
                    @Html.DisplayFor(modelItem => item.Poster)
                </td>
                <td  style="display:none">
                    @Html.DisplayFor(modelItem => item.InitDate)
                </td>
                <td  style="display:none">
                    @Html.DisplayFor(modelItem => item.UpdateDate)
                </td>
                
                <td>
                    @Html.ActionLink("編輯", "Edit", new { id = item.Id },new { @class = "btn btn-primary" })
                    @Html.ActionLink("刪除", "Delete", new { id = item.Id },new { @class = "btn btn-primary" })
                    @Html.Hidden("ID", item.Id)
                </td>
                
            </tr>
        }
    </tbody>
</table>

@if (ViewData["SearchByTitle"] == null || ViewData["SearchByTitle"].ToString()=="")
{ 
    using (Html.BeginForm("Sort",null))
    {
        <div>
            <input type="hidden" id="sortData" name="sortData"/>
            <input type="submit" value="更新排序" class="btn-button" />            
        </div>
    }
}
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script src="@Url.Content("~/Scripts/jquery.tablednd.0.5.js")" type="text/javascript"></script>
   
    <script>
        $(document).ready(function() {
            $("tbody").tableDnD({
                onDragClass: "showDragHandle",
                onDrop: function(table, row) {
                    var rows = table.rows;
                    var map = "";
                    for (var i = 0; i < rows.length; i++) {
                        $(rows[i]).find(".position").val(i+1);
                        map += $(rows[i]).find("#ID").val() + ":" + (i+1) + ",";
                    }
                    $("#sortData").val(map);
                }
            });
        });
    </script>
    <style>
        .position {
            width: 27px;
        }
    </style>
}

