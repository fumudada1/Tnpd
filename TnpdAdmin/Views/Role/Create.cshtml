@using System.Collections

@model TnpdModels.Role

@{
    ViewBag.Title = "Create";
}

<h2 class="page-title"><i class="fa fa-pencil-square-o"></i>新增角色</h2>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)

    <fieldset>
        <legend>角色</legend>
<table class="table table-h">
  <tr>
    <th width="120">
            @Html.LabelFor(model => model.Subject)
      
    </th>
    <td>
       @Html.EditorFor(model => model.Subject)
            @Html.ValidationMessageFor(model => model.Subject)
    </td>
  </tr>
  <tr>
    <th>
      
    </th>
    <td>
       @Html.LabelFor(model => model.Permission)
            <div id="tree3"></div>
            @Html.HiddenFor(model => model.Permission)
    </td>
  </tr>
  <tr>
    <th>
            @Html.LabelFor(model => model.Members)
      
    </th>
    <td>
      <div style="float: left; width: 250px; border-color: black; border-style: double; padding: 5px">
          <select id="Categories1" name="Categories1">
          </select>
          <select id="Categories2" name="Categories2">
          </select>
          <select id="MemberList" multiple="multiple" name="MemberList" aria-invalid="false" class="valid">


          </select>
            </div>
            <div style="float: left; width: 57px; padding: 0px 10px;margin-top: 100px">
                <input type="button" value="==＞" id="toRight"/>
                <input type="button" value="＜==" id="toLeft" />
            </div>
            <div style="float: left; width: 250px; border-color: black; border-style: double; padding: 5px;height: 280px">
                <select name="MemberListSelect" multiple="multiple" id="MemberListSelect" style="height: 270px">
                </select>
            </div>
         <div style="clear: both"></div>

            @Html.ValidationMessageFor(model => model.Members)
    </td>
  </tr>
 
  
</table>
       
        <input type="hidden" name="UnitId" value="@ViewBag.ca1" />
    </fieldset>
     <input type="submit" value="新增" class="btn-button" />
}

<div>
    @Html.ActionLink("回列表", "Index")
</div>

@section Scripts {

    <script src="~/Scripts/jquery-ui.custom.js" type="text/javascript"></script>


    <link href="~/Content/themes/base/skin/ui.dynatree.css" rel="stylesheet" type="text/css" id="skinSheet">
    <script src="~/Scripts/jquery.dynatree.js" type="text/javascript"></script>
    <script src="~/Role/TreeScript/0" type="text/javascript"></script>
    <script>
        $(document).ready(function() {
            var cat1 = @ViewBag.ca1;
            var cat2 = @ViewBag.ca2;
            var isAdmin = '@ViewBag.admin';
            $.getJSON("/units/GetfistUnit").done(function(json) {
                data = json;

                $.each(json,
                    function(i, item) {
                        if (item.Id == cat1) {
                            $('#Categories1').append($("<option></option>").attr("value", item.Id)
                                .attr("selected", "selected").text(item.Subject));
                        } else {
                            $('#Categories1').append($("<option></option>").attr("value", item.Id).text(item.Subject));
                        }


                    });

                var cat1id = $('#Categories1').val();
                $.getJSON("/units/GetUnit/" + cat1id).done(function(json) {
                    data = json;


                    $.each(json,
                        function(i, item) {
                            if (item.Id == cat2) {
                                $('#Categories2').append($("<option></option>").attr("value", item.Id)
                                    .attr("selected", "selected").text(item.Subject));
                            } else {
                                $('#Categories2').append($("<option></option>").attr("value", item.Id)
                                    .text(item.Subject));
                            }


                        });
                    var cat2id = $('#Categories2').val();

                    $.getJSON("/units/GetMemberByUnitId/" + cat2id  + "?RoleID=0").done(function(json) {
                        data = json;
                        $.each(json,
                            function(i, item) {
                                $('#MemberList').append($("<option></option>").attr("value", item.Id)
                                    .text(item.Name));


                            });
                    });


                });


                if (isAdmin == 'False') {
                    $('#Categories1').attr('disabled', 'disabled');

                }
            });

            $('#Categories1').change(function() {
                if ($('#Categories1').val() != '') {
                    $('#Categories2').children().remove();

                    var id = $('#Categories1').val();
                    $.getJSON("/units/GetUnit/" + id).done(function(json) {
                        data = json;


                        $.each(json,
                            function(i, item) {
                                $('#Categories2').append($("<option></option>").attr("value", item.Id)
                                    .text(item.Subject));

                            });

                        $('#MemberList').children().remove();

                        var id = $('#Categories2').val();
                        $.getJSON("/units/GetMemberByUnitId/" + id+ "?RoleID=0").done(function(json) {
                            data = json;


                            $.each(json,
                                function(i, item) {
                                    $('#MemberList').append($("<option></option>").attr("value", item.Id)
                                        .text(item.Name));

                                });


                        });
                    });
                } else {
                    $('#Categories2').children().remove();

                    $('#Categories2').append($("<option></option>").attr("value", '').text('請選擇'));

                }


            });

            $('#Categories2').change(function() {
                if ($('#Categories2').val() != '') {
                    $('#MemberList').children().remove();

                    var id = $('#Categories2').val();
                    $.getJSON("/units/GetMemberByUnitId/" + id + "?RoleId=0").done(function(json) {
                        data = json;


                        $.each(json,
                            function(i, item) {
                                $('#MemberList').append($("<option></option>").attr("value", item.Id)
                                    .text(item.Name));

                            });


                    });
                } else {
                    $('#MemberList').children().remove();

                    $('#MemberList').append($("<option></option>").attr("value", '').text('請選擇'));

                }


            });

            $("#toRight").click(function() {

                $("#MemberList").children(":selected").each(function() {
                    $(this).appendTo("#MemberListSelect");
                });
            });

            $("#toLeft").click(function() {

                $("#MemberListSelect").children(":selected").each(function() {
                    $(this).appendTo("#MemberList");
                });
            });

        });
    </script>
}
