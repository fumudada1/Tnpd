@using TnpdModels

<div class="row">
   
    <div class="col-12">
        @using (Html.BeginForm(null, null, new { @class = "form form-vaild form-aligned trailer" }))
        {
            @Html.AntiForgeryToken()
            @Html.ValidationSummary(true)
            @ViewBag.Message
     
            <p>
                親愛的民眾您好：<br>
                感謝您使用本局的信箱，透過信箱可以讓我們知道您的需求及問題在哪裡， 以便為您做更多的服務，真正達到落實"便民"的目標。<br>
                (有 <span class="text-danger">*</span> 號請務必填寫)
            </p>

            <div class="hrline"></div>

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label class="col-form-label" for="CaseID"><span class="text-danger">*</span>
                        案號：</label>
                
                    <input class="form-control" data-val="true" data-val-required="請輸入案號" id="CaseID" name="CaseID" placeholder="請輸入案號" type="text" value="" />
                    <span class="field-validation-valid" data-valmsg-for="CaseID" data-valmsg-replace="true"></span>
                </div>
            </div>

            <div class="form-group">
                <label class="col-form-label" for="Email"><span class="text-danger">*</span>
                    E-Mail：</label>
                <input id="Email" class="form-control" data-val="true" data-val-email="Email 格式錯誤" data-val-required="Email必填" name="Email" placeholder="請輸入E-Mail" type="text" value="" />
                <span class="field-validation-valid" data-valmsg-for="Email" data-valmsg-replace="true"></span>
            </div>

            <div class="form-row  mt-4">
                <label class="col-form-label" for="checkCode"><span class="text-danger">*</span>
                    驗證碼：</label>

                <div class="form-group col-auto">
                    <img id="imgVerify" src="~/Captcha/CaptchaImage" alt="點擊更换驗證碼" tabindex="0" onclick="fleshVerify()" />
                    <a href="javascript:void(0);" onkeypress="PlayCode()" onclick="PlayCode();"><img id="imgRead" tabindex="0" src="~/images/maintb.gif" alt="播放聲音。"  /></a>
                   
                </div>
                <div class="form-group col-md-3">
                    <input id="checkCode" class="form-control"  name="checkCode" placeholder="請輸入驗證碼" type="text" /><noscript>您的瀏覽器無支援 JavaScript,無法使用此服務</noscript>
                   
                    @Html.ValidationMessage("CheckCode")              
                </div>

            </div>

            <div class="hrline"></div>
            <input type="hidden" name="id" value="@ViewBag.UnId"/>
            <div class="form-row justify-content-center">
                <div class="col-auto">
                    <button type="submit" class="btn btn-info">送出</button>
                </div>
                <div class="col-auto">
                    <button type="reset" class="btn btn-secondary">清除</button>
                </div>
            </div>
        }
    </div>
</div>
@if (ViewBag.MyCase != null)
{
    Case myCase = ViewBag.MyCase;
    
    <div style="color: blue">查詢結果</div>
    <table border="1" cellpadding="2" cellspacing="1">
        <tbody>
       
        <tr>
         
            <td>收件編號</td>
            <td>&nbsp;@myCase.CaseID</td>
            <td></td>
            <td></td>
        </tr>
       
        <tr>
            <td colspan="3">預定完成日期</td>
            <td>&nbsp;@myCase.Predate.ToString("yyyy/MM/dd")</td>
        </tr>
              
        <tr>
            <td>e-mail信箱</td>
            <td colspan="3">&nbsp;<a href="mailto:@myCase.Email" target="_blank">@myCase.Email</a></td>
        </tr>
        <tr>
            <td>主旨</td>
            <td colspan="3">&nbsp;@myCase.Subject</td>
        </tr>
        <tr>
            <td>來信內容</td>
            <td colspan="3">&nbsp;@Html.Raw(UIUtility.Txt2Html(myCase.Content) )</td>
        </tr>
        <tr>
            <td>處理結果</td>
            <td colspan="3">&nbsp;
                @if (myCase.Poprocs.Count == 0)
                {
                    <span>案件處理中</span>
                }else if (myCase.Poprocs.FirstOrDefault().Status != CaseProcessStatus.結案)
                {
                    <span>案件處理中</span>
                }
                else
                {
                    @Html.Raw(UIUtility.Txt2Html(myCase.Poprocs.FirstOrDefault().AssignMemo) )
                }

            </td>
        </tr>
        </tbody>
    </table>
                     
}
@if (ViewBag.traffic != null)
{
    CaseTraffic myCase = ViewBag.traffic;
    
    <div style="color: blue">查詢結果</div>
    <table border="1" cellpadding="2" cellspacing="1" style="width: 100%">
        <tbody>
       
        <tr>
            <td>收件編號</td>
            <td>&nbsp;@myCase.CaseID</td>
            <td></td>
            <td></td>
        </tr>
      
        <tr>
            <td >預定完成日期</td>
            <td colspan="3">&nbsp;@myCase.Predate.ToString("yyyy/MM/dd")</td>
        </tr>
              
      
        <tr>
 <td>違規地點</td>
            <td colspan="3">@myCase.violation_place_area @myCase.violation_place_road @myCase.violation_place</td>
        </tr>
        <tr>
            <td>違規時間</td>
            <td colspan="3">違規時間：@myCase.violation_date.ToString("yyyy/MM/dd")  @myCase.violation_time</td>
        </tr>
        <tr>
            <td>違規車號</td>
            <td>@myCase.violation_carno</td>
            <td>違規事項</td>
            <td>@myCase.itemno</td>
        </tr>
        <tr>
            <td>主旨</td>
            <td colspan="3">&nbsp;@myCase.Subject</td>
        </tr>
        <tr>
            <td>來信內容</td>
            <td colspan="3">&nbsp;@Html.Raw(UIUtility.Txt2Html(myCase.Content))</td>
        </tr>
        <tr>
            <td>處理結果</td>
            <td colspan="3">&nbsp;
                @if (myCase.Poprocs.Count == 0)
                {
                    <span>案件處理中</span>
                }else if (myCase.Poprocs.FirstOrDefault().Status != CaseProcessStatus.結案)
                {
                    <span>案件處理中</span>
                }
                else
                {
                    @Html.Raw(UIUtility.Txt2Html(myCase.Poprocs.FirstOrDefault().AssignMemo) )
                }

            </td>
        </tr>
        </tbody>
    </table>
                     
}

<script type="text/javascript">
    function PlayCode() {
        var name = ReadCookie("CheckCode");
        var url2 = "/wav/" + name + ".wav";

        if (/(MSIE|Trident\/|Edge\/)/i.test(navigator.userAgent)) {
            //本來這裡用的是<bgsound src="system.wav"/>,結果IE8不播放聲音,於是換成了embed
            $('#newMessageDIV').html("<embed src='" + url2 + "'/>");
        } else {
            //Firefox,Chrome均支持<audio/>
            $('#newMessageDIV').html("<audio autoplay='autoplay'><source src='" + url2 + "' type='audio/wav'/></audio>");
        }
    }


    function fleshVerify() {

        //重载验证码

        var time = new Date().getTime();

        document.getElementById('imgVerify').src = '/Captcha/CaptchaImage/' + time;

    }
    function ReadCookie(name) {
        var dc = document.cookie;
        var start1 = dc.indexOf(name + "=");
        if (start1 == -1) {
            return "";
        }
        else {
            start = dc.indexOf("=", start1) + 1;
            var end = dc.indexOf(";", start);
            if (end == -1) {
                end = dc.length;
            }
            var value = unescape(dc.substring(start, end));
            if (value == null) {
                return ""
            }
            else {
                return value;
            }
        }
    }
</script>
<style>
    .field-validation-error {
        color:red
    }
</style>
<script src="/js/jquery.validate.js"></script>

<script src="/js/jquery.validate.unobtrusive.js"></script>
<script src="/js/jquery.unobtrusive-ajax.min.js"></script>